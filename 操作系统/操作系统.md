# 操作系统
## 操作系统的类型与结构
### 定义
- 操作系统的定义: 操作系统是计算机系统中的核心系统软件,负责管理和控制计算机系统中的硬件和软件资源
### 操作系统分类
1. 批处理操作系统
    把用户提交的作业分类,把一批作业编成一个作业执行序列.
    批处理又可以分为联机批处理和脱机批处理
    特征：用户脱机使用计算机、成批处理、多道程序运行
2. 分时操作系统
    采用分时技术,使多个用户同时以绘画方式控制自己程序运行,每个用户都感到似乎各自有一台独立的、支持自己请求服务的系统
    分时技术把处理机的运行时间分成很短的时间片, 按时间片轮流把处理机分配给各个联机作业使用.
    若某个作业在分配给它的时间片内不能完成作业,则改作业暂时中断, 处理机让给另一个作业使用,未完成的作业等待下一轮在继续作业,直到作业完成.
    特征: 交互性、多用户同时性、独立性
3. 实时操作系统
    实时操作系统往往是专用的, 系统与应用难以分离. 
    实时操作系统并不强调资源利用率，更关心及时性、可靠性和完整性
    特性: 提供即时响应、高可靠性
4. 网络操作系统
    网络操作系统按照网络架构的各个协议标准进行开发，包括网络管理、通信、资源共享、系统安全和多种网络应用服务等.
    特征： 互操作性、协作处理
5. 分布式操作系统
    分布式操作系统要求一个统一的操作系统，实现系统操作的统一性，负责全系统的资源分配和调度，为用户提供统一的界面
    
6. 嵌入式操作系统
7. 微内核操作系统
8. ...

### 操作系统的结构
- 操作系统的结构可分为**无序结构、层次结构、面向对象结构、对称多出力结构和微内核结构**
1. 无序结构
    **无序结构又称为整体结构或模块组合结构**
    它以大型表格和队列为中心，操作系统的各个部分的程序围绕表格运行，整个系统是一个程序。这种操作系统通常称为面向过程的操作系统。
    操作系统由许多标准的、可兼容的基本单位构成，各模块相对独立，模块之间通过规定的接口互相调用。
    模块化设计方法的优点: 缩短系统开发周期, 缺点: 模块之间调用关系复杂\相互依赖，分析、移植和维护系统较容易出错

2. 层次结构
    把一个大型复杂的操作系统分解成若干个**单向依赖**的层次,由多层的正确性保证操作系统的可靠性.层次结构清晰，简化了接口的设计，且有利于系统功能的增加或减改，易于保证可靠性、便于维护和移植.
    
    
3. 面向对象结构
    在计算机系统中对象是操作系统管理的信息和资源的抽象,是一种抽象的数据类型.
    
4. 对称多处理结构
    如果一个操作系统在系统中的所有处理机运行且共享同一内存,这样的系统就是一个对称多处理系统。
    优点: 适合共享存储器结构的多处理机系统
    
    

5. 微内核结构
    把系统的公共部分抽象出来,形成一个底层核心, 提供最基本的服务,其他功能以服务器的形式建立在微内核之上
    微内核结构由一个非常简单的硬件抽象层和一组比较关键的原语或系统调用组成，原语仅包括了建立一个系统必须的部分
        1. 线程管理
        2. 地址空间
        3. 进程间通讯
    微内核的目标是将系统服务的实现和系统的基本操作规则分离.
    技术优点
        1. 统一的接口，在用户态和核心态之间无需进程识别
        2. 可伸缩性好，能适应硬件更新和应用变化
        3. 可移植性好, 所有与具体机器特征相关的代码,全部隔离在微内核中,如果操作系统要移植到不同的硬件平台上,只需要修改微内核中的代码即可
        4. 实时性好, 微内核可以方便地支持实时处理
        5. 安全性，可靠性搞，微内核将安全性作为系统内部特性来进行设计. 对外仅使用少量应用编程接口
        6. 支持分布式系统, 支持多处理器的架构和高度并行的应用程序
        7. 面向对象的操作系统
    

### 两种工作状态
1. 核心态
2. 用户态
- 我们使用的应用程序公仔用户态,而内核模块和最基本的操作系统核心工作在核心态    
    



### 操作系统的五个基本功能
1. 处理机管理
2. 存储管理
3. 设备管理
4. 文件管理
5. 作业管理


## 操作系统基本原理
- 操作系统的主要功能是: **进行处理机与进程管理、存储管理、设备管理、文件管理和作业管理的工作**


### 进程管理

#### 三态模型
- 进程的状态
    1. 就绪状态
        - **当进程已分配了除CPU以外的所有必要资源后,只要获得处理机就可以执行**.此时的状态就是就绪状态.
        在一个系统中可以有多个进程处于就绪状态. 通常把他们排成一个队列: **就绪队列**
    2. 执行状态
        - **执行状态是指进程已经得到处理机**. 再单处理机系统中只有一个进程处于执行状态
    3. 阻塞状态
        - 阻塞状态是指: **进程因发生某些时间(I/O操作,申请缓冲空间)而暂停的状态.**
         通常处于阻塞状态的进程也会被排成一个队列：**阻塞队列**
         
    
- 进程状态的变化
    1. 运行态->等待态
        等待使用资源
    2. 等待态->就绪态
        资源以满足要求 
    3. 运行态->就绪态
        运行时间片到
    4. 就绪态->运行态
        CPU 空闲时选择一个就绪进程


### 信号量与PV操作
- 信号量: 一种特殊的变量,表现形式是一个整形S和一个队列
- P操作: S= S-1 若 S<0 进程暂停执行,进入等待队列
- V操作: S=S+1 若 S<=0 唤醒等待队列中的一个进程

#### 互斥控制
- 互斥控制是为了保护共享资源, 不让多个进程同时访问这个共享资源.


### 死锁
- 死锁是指多个进程之间互相等待对方资源,而在得到对方资源之前又不释放自己的资源,造成循环等待.

#### 死锁的必要条件
1. 互斥条件: 即一个资源每次只有一个进程使用
2. 保持与等待条件: 有一个进程已经获得资源,单因请求其他资源时被阻塞,持有该资源者不释放
3. 不可抢占条件: 有些系统资源是不可抢占的, 当某个进程以获得这类资源后,系统不能强行收回，只能由进程使用完是自己释放
4. 循环等待条件: 若干个进程形成环形链,每个资源都占用对方申请的资源



#### 银行家算法
- 在分配资源之前先确认资源分配后是否会导致系统死锁,如果不会死锁就分配.
- 分配原则
    1. 当一个进程对资源的最大需求量不超过系统中的资源数时可以接纳该进程
    2. 进程可以分期请求资源，但请求的总数不能超过最大需求量
    3. 当系统现有的资源不能满足进程尚需资源数时,对进程的请求可以推迟分配,但总能使进程在有限的时间里得到资源
    4. 当系统现有的资源能满足进程尚需资源数时, 必须测试系统现存的资源能否满足该进程尚需的最大资源数,若能满足则按当前的申请量分配资源，否则也需要推迟分配


#### 死锁的解决策略
1. 死锁预防: 破坏死锁的必要条件中的任意一个
2. 死锁避免: 是指进程在每次申请资源是判断这些操作是否安全
3. 死锁检测: 死锁检测判断系统是否处于死锁状态
4. 死锁解除: 将某进程拥有的资源强行收回,分配给其他进程


### 存储管理
- 存储管理是对**内存储器的管理,负责对内存的分配和回收、内存的保护和内存的扩充**

### 存储组织
- 虚拟存储器可以分为**单一连续分区、固定分区、可变分区、可重定向分区、页式、段式、段页式**


#### 单一连续分区
- 把所有用户区都分配给唯一的用户作业. 当作业被调度时, 进程全部进入内存,一旦完成,所有内存恢复空闲,因此它不支持多道程序设计

#### 固定分区
- 支持多道程序设计的最简单的存储管理方法.
- 把内存划分成若干个固定的和大小不同的分区，每个分区能够装入一个作业,分区的大小是固定的,算法简单,但容易生成较多的存储器碎片

#### 可变分区
- 引入可变分区后虽然内存分配更加灵活,也提高了内存利用率,但是由于系统不断地分配和回收必然会出现一些不连续的小的空闲区.
- 解决空闲区(碎片)的方法式拼接(紧凑),向一个方向移动已分配的作业,使那些零散的小空间区在另一方向练成一片.
- 分区的拼接技术一方面要求能够对作业进行重定位,另一方面系统在拼接式要耗费较多的时间

#### 可重定位分区.
- 它能够把相邻的空闲存储空间合并成一个完整的空区,还能够整理存储器内各个作业的存储未知，以达到消除存储碎片和紧缩存储空间的目的.
- 紧缩工作需要花费大量的时间和系统资源


#### 页式
- 基本原理: 将各进程的虚拟空间划分成为若干个长度相等的页，把内存空间以与页相等的大小划分为大小相等的片或页面,采用请求调页或预吊页技术实现内外村的统一管理
- 优点: 利用率高,产生的内存碎片小,内存空间分配及管理简单
- 缺点: 相应的硬件支持，增加系统开销,请求调页的算法如果不当,可能产生抖动现象

- 基本思想:
    把程序的逻辑空间和内存的物理空间按照同样的大小划分成若干个页面,并以页面为单位进行分配.
    在页式存储管理中,系统中的虚地址是一个有序对.
    

        
    
#### 段式
- 一个作业是由若干个具有逻辑意义的段组成.
    在短时存储管理中,允许程序占据内存中若干分离的分区.
    分段系统中的虚地址是一个有序对。
- 优点: 便于多道程序共享内存，便于对存储器的保护,各段程序修改互不影响
- 缺点: 内存利用率低,内存碎片浪费大


#### 段页式. 
- 分段式和分页式结合的存储管理方法.




### 存储管理
- 在虚拟存储器的管理中,涉及**载入(调入)、放置(放入分区)和置换等问题**
- 调入策略: 何时将一页或一段从外存中调入内存. 
    1. 请求调入法,即需要使用时调入
    2. 先行调入法,将预计要使用的页、段先行调入内存
- 防止策略: 调入后,放在内存的什么未知
- 页面调度算法(淘汰机制\置换策略)
    1. OPT 最优算法:
        选择不再使用或最远的将来才使用的页
    2. RAND 随机算法
        随机的选择需要淘汰的页
    3. FIFO 先进先出
        淘汰在内存中驻留时间最长的
    4. LRU 最近最少使用

### 设备管理

#### 数据传输控制方式
- 控制设备和内存或CPU之间的数据传输
选择和衡量控制方式的原则
1. 数据传输速度足够高，能满足用户的需要并且不丢失数据
2. 系统开销少，所需要的控制程序少
3. 充分发挥硬件资源,将I/O设备尽可能处于使用中状态，并且CPU 等待时间少

### 文件管理
- 文件管理是对外部存储设备上的以文件方式存放的信息的管理


#### 文件的逻辑结构
1. 顺序文件
    大多数文件式顺序文件
2. 索引顺序文件
3. 索引文件
4. 直接文件


#### 文件的逻辑组织
- 文件的逻辑结构可以分为无结构的字符流文件和有结构的记录文件
常用记录式结构
1. 连续结构
    连续结构是一种按照记录生成的先后顺序排列的逻辑结构
    特点: 适用性强，可用于所有文件，且记录的排列顺序与记录的内容无关
    缺点: 搜索性能较差
2. 多重结构
    多重结构把记录按键和记录名排列成行列式结构,一个包含n个记录名,m个键的文件构成 m*n 的行列式
3. 转置结构
    转置结构把含有相同键的记录指针全部指向该键,
    转置结构适用于给定键后的记录搜索
4. 顺序结构
    顺序结构把文件中的键按规定的顺序排列起来
    
    
- 常用存取方法
    1. 顺序存取
    2. 随机存取
    3. 按键存取


#### 文件的物理组织
- 文件的物理结构是指文件在存储设备上的存储方法,常用的文件物理结构有**连续文件、串联文件、索引文件**


##### 连续文件(顺序文件)
- 连续文件式一种最简单的物理文件结构，他把一个在逻辑上连续的文件信息依次存放到物理块中.
优点: 一旦知道文件在文件存储设备上的起始位置和文件长度,就能进行存取.
    连续文件适合于顺序存取，在连续存取相邻信息时，存取速度快
缺点: 在文件建立时必须指定文件的信息长度,以后不能动态增长,不适用于要经常修改的文件.

##### 串联文件(链接文件)
- 串联文件是用非连续的物理块来存放文件信息,这些物理块之间没有顺序关系,其中每个物理块都有一个执政,指向下一个物理块的地址,这样所有的物理块都被链接起来，形成一个链接队列
优点: 解决存储器的碎片问题,提高存储空间利用率.
缺点: 由于串联文件只能按照队列中的链接指针顺序查找,因此搜索效率低,一般只适用于顺序访问,不适用于随机存取

##### 索引文件
- 索引文件是另一种对文件存储不连续分配的方法. 为每个文件建立一张索引表，索引表中的每一表项目指出文件信息所在的逻辑块号和与之对应的物理块号
    索引文件既可以满足文件动态增长的要求又可以方便的实现随机存取.
    对一些大的文件，当索引表的大小超过了一个物理块时，会发生索引表的分配问题。采用多级(间接索引)技术,这时在由索引表指出的物理块中存放的不是文件住处二十存在文件信息的物理块地址.
    
优点: 顺序存取 和 随机存取都适用
缺点: 索引表增加了存储空间的开销,在存取文件时至少要访问2词磁盘.一次访问索引表,另一次是根据索引表提供的物理块号访问文件信息



#### 树形目录结构
- 文件控制块的集合称为文件目录,文件目录也被组织成文件,通常成为目录文件
- 在树形目录结构中,树的根节点为根目录,数据文件为叶子,
- 系统在创建每一个目录时都会设定2个目录文件
    1. `.` 代表目录自己
    2. `..` 代表该目录的父目录
    - 对于根目录 `.`和`..`都代表自己



#### 文件分配策略
1. 顺序分配
2. 链接分配
3. 索引分配


### 存储空间管理
- 由于文件存储设备是分成许多大小相同的物理块,并以块为单位交换信息,因此文件存储设备的管理实质上是对空闲块的组织和管理,它包括:空闲块的组织、空闲块的分配空闲块的回收.

#### 空闲表法
- 空闲表法属于连续分配,系统为外存上的所有空闲区建立一张空闲表,每个空闲区对应一个空闲表项,包括 **序号、第一空闲盘块号和空闲盘块数**

#### 空闲链表法
- 将所有空闲盘区，拉成一条空闲链,根据构成链所用的基本元素不同可以分为两种形式
##### 空闲盘块链
- 将磁盘上所有空闲区空间，以盘块为单位拉成一条链，
    当用户创建文件而请求分配内存时,系统从链首开始,依次摘下适当数目的空闲盘块用来创建文件. 
    当用户删除文件而释放存储空间时,系统将回收的盘块依次插入空闲盘块链的末尾,
    
##### 空闲盘区链
- 将磁盘上所有空闲盘区拉成一条链,在每个盘区上包含若干用于指示下一个空闲盘区的指针,指明盘区大小的信息.
    分配盘块时通常采用**首次适应算法(显示链接法)**.回收时要将回收区与空闲盘区相合并
    
    
#### 位图法
- 位图用二进制标识磁盘中的一个盘块的使用情况,0表示空闲,1表示已分配.磁盘上的所有盘块都与一个二进制位相对应,由所有的二进制为构成的集合,称为位图.
    位图法的优点是容易找到一个或一组相邻的空闲盘块.
    位图小,可以把它保存在内存中,从而节省磁盘的启动操作



#### 成组链接法
- 成组链接法将空闲表和空闲链表法组合形成的一种空闲盘块管理方法,适用于大型文件系统







### 地址变换
- 编程所用的地址称为逻辑地址(虚地址) , 而实际的内存地址则是物理地址(实地址).

#### 静态重定位
- 静态重定位是在需空间程序执行之前由装配程序完成地址映射工作.
    静态重定位的优点是不需要硬件的支持
    缺点是无法实现虚拟存储区,必须占用连续的内存空间且难做到程序和数据的共享


#### 动态重定位
- 动态重定位实在程序执行过程中，在CPU访问内存之前,将要访问的程序或数据地址转换为内存地址.
    动态定位依靠硬件地址变换机构完成功能.
    优点: 对内存非连续分配,提供虚拟存储器的基础，有利于程序段的共享







### 作业管理

#### 4个状态
1. 提交状态
    作业由输入设备进入外存储器的过程
2. 后备状态
    当作也的全部信息进入外存后，系统就为改作业建立一个作业控制块,
3. 执行状态
    一个后背作业被作业调度程序选中,并分配了必要的资源进入了内存,且作业调度程序为其建立了相应的进程
4. 完成状态
    当作业正常运行结束,它所占用的资源尚未完全被系统回收时的状态.
    
    
#### 三级调度
1. 高级调度
    高级调度也称为作业调度,高级调度的主要功能是在批处理作业的后备作业队伍中选择一个或一组作业,为他们建立进程,分配必要的资源,使他们能够运行起来
2. 中级调度
    中级调度也称为交换调度，中级调度决定进程在内外存之间的调入、调出.其主要功能是在内存资源不足时将某些处于等待状态或就绪状态的进程调出内存,腾出空间后,再将外存上的就绪进程调入内存
3. 低级调度
    低级调度也称为进程调度,其主要功能时确定处理器在旧墟进程间的分配
    
#### 作业调度算法
1. 先来先服务(FCFS)
    按作业到达的先后顺序调度
2. 短作业有限
    按作业的估计运行使劲按调度,估计运行时间段的作业优先调度
3. 响应比高者优先
4. 优先级调度
    根据作业的优先级别,优先级高的先调用
    
    
### 设备管理
- 设备管理程序主要提供以下功能
    1. 提供和进程管理系统的接口
    2. 进行设备分配
    3. 实现设备和设备,设备和CPU等之间的并行操作
    4. 缓冲区管理
    

### 网络操作系统
- 功能
    1. 提供高效可靠的网络通讯能力
    2. 提供多项网络服务功能
- 特征
    1.硬件独立
    2. 网络特性
    3. 可移植性和可集成性
    4. 多用户、多任务

#### 网络操作系统的组成
- 网络操作系统由**网络驱动程序\子网协议和应用层协议**
1. 网络驱动程序
   
2. 子网协议

3. 应用层协议